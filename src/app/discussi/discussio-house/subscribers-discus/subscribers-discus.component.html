<ng-container *ngIf="loading; else content">
  <app-loader></app-loader>
</ng-container>

<ng-template #content>
  <div class="container-box">

    <div class="card-box col-lg-6 col-md-5 col-sm-6 col-12">
      <div class="scrollable-container p-3">
        <div class="card-wrapper card mb-4" *ngFor="let subscriber of subscribers"
          [ngClass]="{ 'selected': selectedSubscriber?.user_id == subscriber.user_id }"
          (click)="onSubscriberSelect(subscriber)">
          <div class="card-img-container w-50">
            <img class="card-img"
              [src]="'http://localhost:3000/img/users/' + (subscriber.img ? subscriber.img : 'user_default.svg')"
              alt="User Image">
          </div>
          <div class="card-body w-50">
            <div class="title-group p-1">
              <div class="title">{{ subscriber.lastName }}</div>
              <div class="title">{{ subscriber.firstName }}</div>
              <div class="title">{{ subscriber.surName }}</div>
            </div>
            <div class="btn-group">
              <button class="btn m-1" (click)="openDialog(subscriber.user_id)">
                <i class="fa-solid fa-user-xmark"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <mat-paginator class="mb-1" [pageIndex]="pageEvent?.pageIndex" [length]="subscribers.length"
        [pageSize]="pageEvent?.pageSize" [pageSizeOptions]="[6, 12, 24, 100]" (page)="onPageChange($event)"
        aria-label="Select page">
      </mat-paginator>
    </div>

    <div class="card-box col-lg-6 col-md-5 col-sm-6 col-12">
      <div class="card-animation p-2" [@cardAnimation2] *ngIf="!isFeatureEnabled">
        <div class="card m-2">
          <div class="img-fluid">
            <img [src]="'http://localhost:3000/img/users/' + (selectedSubscriber?.img || 'user_default.svg')"
              alt="User Image">
          </div>

          <div class="item-wrapper p-2">
            <p>ID Користувача: {{ selectedSubscriber?.user_id }}</p>
            <div class="user-name">{{ selectedSubscriber?.lastName }} {{ selectedSubscriber?.firstName }} {{
              selectedSubscriber?.surName }}
            </div>
            <div class="card-social-link">
              <a target="_blank" *ngIf="selectedSubscriber?.instagram" [href]="'selectedSubscriber?.instagram'">
                <i class="fab fa-brands fa-instagram"></i>
              </a>
              <a target="_blank" *ngIf="selectedSubscriber?.telegram" [href]="'selectedSubscriber?.telegram'">
                <i class="fab fa-brands fa-telegram"></i>
              </a>
              <a target="_blank" *ngIf="selectedSubscriber?.viber" [href]="'selectedSubscriber?.viber'">
                <i class="fab fa-brands fa-viber"></i>
              </a>
              <a target="_blank" *ngIf="selectedSubscriber?.facebook" [href]="'selectedSubscriber?.facebook'">
                <i class="fab fa-brands fa-facebook"></i>
              </a>
            </div>
            <div class="card-body">
              <div class="card-links">
                <button class="card-link" (click)="toggleMode()"><span>Написати</span><i
                    class="fa-solid fa-message"></i></button>
                <button class="card-link" (click)="createChat(selectedSubscriber)"><span>Створити чат</span><i
                    class="fa-solid fa-message"></i></button>
                <button class="card-link" [routerLinkActive]="'active'"
                  [routerLink]="['/agree-create', selectedSubscriber?.user_id]"><span>Сформувати угоду</span><i
                    class="fa-solid fa-file-contract"></i></button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card-animation" [@cardAnimation2] *ngIf="isFeatureEnabled">
        <div class="card chat-box m-2">
          <div class="card-chat">
            <app-chat-house></app-chat-house>
          </div>
        </div>
      </div>

      <div class="switch-box">
        <button class="toggle-button" (click)="toggleMode()" matTooltip="Змінити">
          <div class="toggle-switch" [class.enabled]="isFeatureEnabled"></div>
        </button>
        <h3 class="switch-box-name">{{ isFeatureEnabled ? 'Повідомлення' : 'Інформація' }}</h3>
      </div>
    </div>

  </div>
</ng-template>
