<div class="container-dis">
  <div class="page-name">
    <h2>Discussio з орендарем</h2>
  </div>

  <div class="container-box">

    <div [@cardAnimation1] class="card-box col-lg-6 col-md-5 col-sm-6 col-12">
      <div class="card m-2">
        <div class="container-sticker">
          <div class="status-container">
            <div class="status online" *ngIf="isOnline">Online</div>
            <div class="status offline" *ngIf="isOffline">Offline</div>
          </div>
        </div>
        <div class="img-fluid">
          <img [src]="'http://localhost:3000/img/users/' + (selectedSubscriber?.photo || 'user_default.svg')"
            alt="User Image">
        </div>


        <div class="item-wrapper p-2">
          <p>ID Користувача: {{ selectedSubscriber?.user_id }}</p>
          <h2>{{ selectedSubscriber?.lastName }} {{ selectedSubscriber?.firstName }} {{ selectedSubscriber?.surName }}
          </h2>
          <div class="card-social-link">
            <a *ngIf="selectedSubscriber?.instagram" [href]="'selectedSubscriber?.instagram'">
              <i class="fab fa-brands fa-instagram"></i>
            </a>
            <a *ngIf="selectedSubscriber?.telegram" [href]="'selectedSubscriber?.telegram'">
              <i class="fab fa-brands fa-telegram"></i>
            </a>
            <a *ngIf="selectedSubscriber?.viber" [href]="'selectedSubscriber?.viber'">
              <i class="fab fa-brands fa-viber"></i>
            </a>
            <a *ngIf="selectedSubscriber?.facebook" [href]="'selectedSubscriber?.facebook'">
              <i class="fab fa-brands fa-facebook"></i>
            </a>
          </div>
          <div class="card-body">
            <div class="card-links">
              <button class="card-link" (click)="openChat(selectedSubscriber?.user_id)"><span>Почати дискусію</span><i
                  class="fa-solid fa-message"></i></button>
              <a class="card-link" [routerLinkActive]="'active'"
                [routerLink]="['/agreement', selectedSubscriber?.user_id]"><span>Сформувати угоду</span><i
                  class="fa-solid fa-file-contract"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div [@cardAnimation2] class="card-box col-lg-6 col-md-5 col-sm-6 col-12" *ngIf="isChatOpen && allMessages && selectedSubscriber">
      <div class="card m-2">
        <div class="chat-header">
          <h3>Назва чату</h3>
          <button class="btn-close" (click)="closeChat()"></button>
        </div>
        <div class="chat-messages">
          <div class="" *ngFor="let message of allMessages">

            <ng-container *ngIf="message.user_id === selectedSubscriber?.user_id">

              <div class="chat-container-user">
                <div class="user-message message p-2">
                  <div class="avatar-wrapper-user">
                    <img class="avatar-user"
                      [src]="'http://localhost:3000/img/users/' + (selectedSubscriber.photo ? selectedSubscriber.photo : 'user_default.svg')"
                      alt="User Image">
                    <div class="name-user">
                      <div class="accent-name"><span class="time">{{ message.time }} </span> {{
                        selectedSubscriber.lastName }} {{ selectedSubscriber.firstName }}</div>
                    </div>
                  </div>
                  <div class="message-content-user">
                    <div class="message-text-user">{{ message.message }}</div>
                  </div>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="message.flat_id !== null">
              <div class="chat-container-owner">
                <div class="owner-message message p-2">
                  <div class="avatar-wrapper-owner">
                    <img class="avatar-owner"
                      [src]="'http://localhost:3000/img/users/' + (userData.img[0].img ? userData.img[0].img : 'user_default.svg')"
                      alt="User Image">
                    <div class="name-owner">
                      <div class="accent-name">{{ userData.inf.lastName }} {{ userData.inf.firstName }} <span
                          class="time">{{ message.time }}</span></div>
                    </div>
                  </div>

                  <div class="message-content-owner">
                    <p class="message-text-owner">{{ message.message }}</p>
                  </div>
                </div>
              </div>
            </ng-container>

          </div>
        </div>

        <div class="chat-input">
          <input type="text" placeholder="Напишіть повідомлення" [(ngModel)]="messageText"
            (keydown.enter)="sendMessage(selectedSubscriber)">
        </div>

        <button class="btn m-1" (click)="sendMessage(selectedSubscriber)">Надіслати</button>
      </div>
    </div>

  </div>
</div>
